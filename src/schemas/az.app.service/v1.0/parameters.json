{
    "$schema": "http://json-schema.org/draft-07/schema",
    "definitions": {
        "app-service": {
            "type": "object",
            "description": "Deploy a single Azure App Service,",
            "properties": {
                "value": {
                    "$ref": "#/definitions/app-service-parameters"
                }
            },
            "required": [
                "value"
            ]
        },
        "app-services": {
            "type": "object",
            "description": "Deploy multiple Azure App Service,",
            "properties": {
                "value": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/app-service-parameters"
                    }
                }
            },
            "required": [
                "value"
            ]
        },
        "app-service-parameters": {
            "type": "object",
            "properties": {
                "appServiceName": {
                    "type": "string"
                },
                "appServiceResourceGroup": {
                    "type": "string"
                },
                "appServiceLocation": {
                    "type": "string"
                },
                "appServiceType": {
                    "type": "string",
                    "oneOf": [
                        {
                            "const": "web"
                        },
                        {
                            "const": "functionapp"
                        },
                        {
                            "const": "functionapp,linux"
                        }
                    ]
                },
                "appServicePlatform": {
                    "type": "string",
                    "oneOf": [
                        {
                            "const": "dotnet"
                        },
                        {
                            "const": "java"
                        },
                        {
                            "const": "node"
                        },
                        {
                            "const": "python"
                        },
                        {
                            "const": "php"
                        }
                    ]
                },
                "appServiceMsiEnabled": {
                    "type": "boolean",
                    "default": false
                },
                "appServiceMsiRoleAssignments": {
                    "type": "array",
                    "items": {
                        "$ref": "../../az.rbac/v1.0/parameters.json#/definitions/roleAssignment"
                    }
                },
                "appServicePlanName": {
                    "type": "string",
                    "description": "The name of the App Service Plan"
                },
                "appServicePlanResourceGroup": {
                    "type": "string",
                    "description": "The name of the resource group in which the App Service Plan lives in"
                },
                "appServiceStorageAccountName": {
                    "type": "string"
                },
                "appServiceStorageAccountResourceGroup": {
                    "type": "string"
                },
                "appServiceAppInsightsName": {
                    "type": "string"
                },
                "appServiceAppInsightsResourceGroup": {
                    "type": "string"
                },
                "appServiceSiteConfigs": {
                    "type": "object",
                    "properties": {
                        "httpsOnly": {
                            "type": "boolean",
                            "default": true
                        },
                        "alwaysOn": {
                            "type": "boolean"
                        },
                        "webSettings": {
                            "type": "object",
                            "properties": {
                                "dotnetVersion": {
                                    "enum": [
                                        "v6.0",
                                        "v3.1"
                                    ]
                                },
                                "phpVersion": {
                                    "enum": [
                                        ""
                                    ]
                                },
                                "pythonVersion": {
                                    "enum": [
                                        ""
                                    ]
                                },
                                "nodeVersion": {
                                    "enum": [
                                        ""
                                    ]
                                },
                                "powerShellVersion": {
                                    "enum": [
                                        ""
                                    ]
                                },
                                "apimGateway": {
                                    "type": "object",
                                    "description": "Link an APIM Gateway to the Web App Deployment",
                                    "properties": {
                                        "apimApiName": {
                                            "type": "string"
                                        },
                                        "apimName": {
                                            "type": "string"
                                        },
                                        "apimResourceGroupName": {
                                            "type": "string"
                                        }
                                    },
                                    "required": [
                                        "apimApiName",
                                        "apimName",
                                        "apimResourceGroupName"
                                    ]
                                }
                            }
                        },
                        "siteSettings": {
                            "type": "array",
                            "description": "The site settings for the app service",
                            "items": {
                                "anyOf": [
                                    {
                                        "type": "object",
                                        "enum": [
                                            {
                                                "name": "FUNCTIONS_EXTENSION_VERSION",
                                                "value": "~4"
                                            },
                                            {
                                                "name": "FUNCTIONS_EXTENSION_VERSION",
                                                "value": "~3"
                                            },
                                            {
                                                "name": "WEBSITE_NODE_DEFAULT_VERSION",
                                                "value": "~16"
                                            },
                                            {
                                                "name": "WEBSITE_NODE_DEFAULT_VERSION",
                                                "value": "~14"
                                            },
                                            {
                                                "name": "WEBSITE_NODE_DEFAULT_VERSION",
                                                "value": "~12"
                                            }
                                        ]
                                    },
                                    {
                                        "type": "object",
                                        "properties": {
                                            "name": {
                                                "type": "string"
                                            },
                                            "value": {
                                                "type": "string"
                                            }
                                        }
                                    }
                                ],
                                "required": [
                                    "name",
                                    "value"
                                ]
                            }
                        },
                        "siteAuthSettings": {
                            "$ref": "#/definitions/app-services-auth-settings"
                        }
                    },
                    "required": [
                        "siteSettings"
                    ]
                },
                "appServiceSlots": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "appServiceSlotName": {
                                "type": "string"
                            },
                            "functions": {
                                "type": "array",
                                "items": {
                                    "type": "object",
                                    "properties": {
                                        "name": {
                                            "type": "string"
                                        },
                                        "isEnabled": {
                                            "type": "boolean"
                                        }
                                    },
                                    "required": [
                                        "name",
                                        "isEnabled"
                                    ]
                                }
                            }
                        },
                        "required": [
                            "appServiceSlotName",
                            "functions"
                        ]
                    }
                },
                "appServiceSlotsConfigNames": {
                    "$ref": "#/definitions/app-services-slots-config-name"
                },
                "appServiceTags": {
                    "type": "object",
                    "patternProperties": {
                        "^[a-z]": {
                            "type": "string"
                        }
                    },
                    "minProperties": 1
                }
            },
            "required": [
                "appServiceName",
                "appServiceType",
                "appServicePlatform",
                "appServiceStorageAccountName",
                "appServiceAppInsightsName",
                "appServiceSiteConfigs"
            ]
        },
        "app-services-slots": {
            "properties": {
                "value": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "appServiceName": {
                                "type": "string",
                                "description": "The Azure App Service in which the slot will rollup under."
                            },
                            "appServiceSlotName": {
                                "type": "string"
                            },
                            "appServiceSlotLocation": {
                                "type": "string"
                            },
                            "appServiceSlotType": {
                                "type": "string",
                                "oneOf": [
                                    {
                                        "const": "web"
                                    },
                                    {
                                        "const": "functionapp"
                                    },
                                    {
                                        "const": "functionapp,linux"
                                    }
                                ]
                            },
                            "appServiceSlotPlatform": {
                                "type": "string",
                                "oneOf": [
                                    {
                                        "const": "dotnet"
                                    },
                                    {
                                        "const": "java"
                                    },
                                    {
                                        "const": "node"
                                    },
                                    {
                                        "const": "python"
                                    },
                                    {
                                        "const": "php"
                                    }
                                ]
                            },
                            "appServiceSlotPlatformVersion": {
                                "type": "string"
                            },
                            "appServiceSlotMsiEnabled": {
                                "type": "boolean",
                                "default": false
                            },
                            "appServiceSlotMsiRoleAssignments": {
                                "type": "array",
                                "items": {
                                    "$ref": "../../az.rbac/v1.0/parameters.json#/definitions/roleAssignment"
                                }
                            },
                            "appServiceSlotPlanName": {
                                "type": "string",
                                "description": "The name of the App Service Plan"
                            },
                            "appServiceSlotPlanResourceGroup": {
                                "type": "string",
                                "description": "The name of the resource group in which the App Service Plan lives in"
                            },
                            "appServiceSlotStorageAccountName": {
                                "type": "string"
                            },
                            "appServiceSlotStorageAccountResourceGroup": {
                                "type": "string"
                            },
                            "appServiceSlotAppInsightsName": {
                                "type": "string"
                            },
                            "appServiceSlotAppInsightsResourceGroup": {
                                "type": "string"
                            },
                            "appServiceSlotSiteConfigs": {
                                "type": "object",
                                "properties": {
                                    "siteHttpsOnly": {
                                        "type": "boolean",
                                        "default": true
                                    },
                                    "siteAlwaysOn": {
                                        "type": "boolean"
                                    },
                                    "siteSettings": {
                                        "type": "array",
                                        "description": "The site settings for the app service",
                                        "items": {
                                            "type": "object",
                                            "properties": {
                                                "name": {
                                                    "type": "string"
                                                },
                                                "value": {
                                                    "type": "string"
                                                }
                                            },
                                            "required": [
                                                "name",
                                                "value"
                                            ]
                                        }
                                    },
                                    "siteAuthSettings": {
                                        "$ref": "#/definitions/app-services-auth-settings"
                                    },
                                    "siteApimSettings": {
                                        "type": "object",
                                        "properties": {
                                            "apimApiName": {
                                                "type": "string"
                                            },
                                            "apimName": {
                                                "type": "string"
                                            },
                                            "apimResourceGroupName": {
                                                "type": "string"
                                            }
                                        },
                                        "required": [
                                            "apimApiName",
                                            "apimName",
                                            "apimResourceGroupName"
                                        ]
                                    }
                                },
                                "required": [
                                    "siteSettings"
                                ]
                            },
                            "appServiceSlotTags": {
                                "type": "object",
                                "patternProperties": {
                                    "^[a-z]": {
                                        "type": "string"
                                    }
                                },
                                "minProperties": 1
                            }
                        },
                        "required": [
                            "appServiceName",
                            "appServiceSlotName",
                            "appServiceSlotType",
                            "appServiceSlotPlatform",
                            "appServiceSlotPlatformVersion",
                            "appServiceSlotStorageAccountName",
                            "appServiceSlotAppInsightsName",
                            "appServiceSlotSiteConfigs"
                        ]
                    },
                    "minItems": 1
                }
            },
            "required": [
                "value"
            ]
        },
        "app-services-slots-config-names": {
            "properties": {
                "value": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "appServiceSlotName": {
                                "type": "string"
                            },
                            "appServiceSlotResourceGroupName": {
                                "type": "string"
                            },
                            "appServiceSlotSettingNames": {
                                "type": "array",
                                "items": {
                                    "type": "string"
                                }
                            },
                            "appServiceSlotConnectionStringSettingNames": {
                                "type": "array",
                                "items": {
                                    "type": "string"
                                }
                            },
                            "appServiceSlotStorageAccountSettingNames": {
                                "type": "array",
                                "items": {
                                    "type": "string"
                                }
                            }
                        },
                        "required": [
                            "appServiceSlotName",
                            "appServiceSlotResourceGroupName",
                            "appServiceSlotSettingNames",
                            "appServiceSlotConnectionStringSettingNames",
                            "appServiceSlotStorageAccountSettingNames"
                        ]
                    }
                }
            },
            "required": [
                "value"
            ]
        },
        "app-services-slots-config-name": {
            "description": "Specify configurations names to be recognized as slot only settings.",
            "properties": {
                "appSettingNames": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "connectionStringSettingNames": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "storageAccountSettingNames": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                }
            },
            "required": [
                "appSettingNames",
                "connectionStringSettingNames",
                "storageAccountSettingNames"
            ]
        },
        "app-services-plan": {
            "type": "object",
            "properties": {
                "value": {
                    "$ref": "#/definitions/app-services-plan-parameters"
                }
            },
            "required": [
                "value"
            ]
        },
        "app-services-plans": {
            "type": "object",
            "properties": {
                "value": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/app-services-plan-parameters"
                    },
                    "maxItems": 1
                }
            },
            "required": [
                "value"
            ]
        },
        "app-services-plan-parameters": {
            "type": "object",
            "properties": {
                "appServicePlanName": {
                    "type": "string"
                },
                "appServicePlanLocation": {
                    "type": "string"
                },
                "appServicePlanResourceGroup": {
                    "type": "string"
                },
                "appServicePlanOs": {
                    "type": "string",
                    "oneOf": [
                        {
                            "const": "windows"
                        },
                        {
                            "const": "linux"
                        }
                    ]
                },
                "appServicePlanSku": {
                    "type": "object",
                    "properties": {
                        "dev": {
                            "type": "string",
                            "$ref": "#/definitions/app-service-plan-sku"
                        },
                        "qa": {
                            "type": "string",
                            "$ref": "#/definitions/app-service-plan-sku"
                        },
                        "uat": {
                            "type": "string",
                            "$ref": "#/definitions/app-service-plan-sku"
                        },
                        "prd": {
                            "type": "string",
                            "$ref": "#/definitions/app-service-plan-sku"
                        },
                        "default": {
                            "type": "string",
                            "$ref": "#/definitions/app-service-plan-sku"
                        }
                    },
                    "required": [
                        "default"
                    ]
                },
                "appServicePlanAseName": {
                    "type": "string"
                },
                "appServicePlanAseResourceGroup": {
                    "type": "string"
                },
                "appServicePlanTags": {
                    "type": "object",
                    "patternProperties": {
                        "^[a-z]": {
                            "type": "string"
                        }
                    },
                    "minProperties": 1
                }
            },
            "required": [
                "appServicePlanName"
            ]
        },
        "app-service-environment": {
            "type": "object",
            "properties": {
                "value": {
                    "$ref": "#/definitions/app-service-environment-parameters"
                }
            },
            "required": [
                "value"
            ]
        },
        "app-service-environments": {
            "type": "object",
            "properties": {
                "value": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/app-service-environment-parameters"
                    },
                    "maxItems": 1
                }
            },
            "required": [
                "value"
            ]
        },
        "app-service-environment-parameters": {
            "type": "object",
            "properties": {
                "appServiceEnvironmentName": {
                    "type": "string"
                },
                "appServiceEnvironmentResourceGroup": {
                    "type": "string"
                },
                "appServiceEnvironmentType": {
                    "type": "string",
                    "default": "ASEV3",
                    "enum": [
                        "ASEV3",
                        "ASEV2",
                        "ASEV1"
                    ]
                },
                "appServiceEnvironmentLocation": {
                    "type": "string"
                },
                "appServiceEnvironmentVirtualNetwork": {
                    "type": "object",
                    "properties": {
                        "virtualNetworkName": {
                            "type": "string"
                        },
                        "virtualNetworkSubnetName": {
                            "type": "string"
                        },
                        "virtualNetworkResourceGroup": {
                            "type": "string"
                        }
                    },
                    "required": [
                        "virtualNetworkName",
                        "virtualNetworkSubnetName",
                        "virtualNetworkResourceGroup"
                    ]
                },
                "appServiceEnvironmentConfigs": {
                    "type": "object",
                    "properties": {
                        "isZoneRedundant": {
                            "type": "string"
                        },
                        "dedicatedHostCount": {
                            "type": "string"
                        },
                        "internalLoadBalancingMode": {
                            "type": "string",
                            "enum": [
                                "Publishing",
                                "Web",
                                "Web, Publishing"
                            ]
                        }
                    }
                }
            },
            "required": [
                "appServiceEnvironmentName",
                "appServiceEnvironmentVirtualNetwork"
            ]
        },
        "app-services-auth-settings": {
            "type": "object",
            "default": {
                "appServiceAuthAction": "Return401",
                "appServiceAuthIdentityClientId": "",
                "appServiceAuthIdentityClientSecretName": "",
                "appServiceAuthIdentityOpenIdIssuer": "https://sts.windows.net/{tenant Id} or https://login.microsoft.com/{tenant Id}"
            },
            "properties": {
                "appServiceAuthAction": {
                    "type": "string",
                    "description": "The unauthenticated action",
                    "oneOf": [
                        {
                            "const": "RedirectToLoginPage"
                        },
                        {
                            "const": "AllowAnonymous"
                        },
                        {
                            "const": "Return401"
                        },
                        {
                            "const": "Return403"
                        }
                    ]
                },
                "appServiceAuthIdentityProvider": {
                    "type": "string",
                    "oneOf": [
                        {
                            "const": "AzureAD"
                        },
                        {
                            "const": "Google"
                        },
                        {
                            "const": "Github"
                        },
                        {
                            "const": "Facebook"
                        }
                    ]
                },
                "appServiceAuthIdentityClientSecretName": {
                    "type": "string"
                },
                "appServiceAuthIdentityClientId": {
                    "type": "object",
                    "properties": {
                        "default": {
                            "type": "string"
                        },
                        "dev": {
                            "type": "string"
                        },
                        "qa": {
                            "type": "string"
                        },
                        "uat": {
                            "type": "string"
                        },
                        "prd": {
                            "type": "string"
                        }
                    },
                    "required": [
                        "default"
                    ]
                },
                "appServiceAuthIdentityOpenIdIssuer": {
                    "type": "object",
                    "properties": {
                        "default": {
                            "type": "string"
                        },
                        "dev": {
                            "type": "string"
                        },
                        "qa": {
                            "type": "string"
                        },
                        "uat": {
                            "type": "string"
                        },
                        "prd": {
                            "type": "string"
                        }
                    },
                    "required": [
                        "default"
                    ]
                },
                "appServiceAuthIdentityScopes": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "appServiceAuthIdentityAudiences": {
                    "type": "object",
                    "properties": {
                        "default": {
                            "type": "array",
                            "items": {
                                "type": "string"
                            }
                        },
                        "dev": {
                            "type": "array",
                            "items": {
                                "type": "string"
                            }
                        },
                        "qa": {
                            "type": "array",
                            "items": {
                                "type": "string"
                            }
                        },
                        "uat": {
                            "type": "array",
                            "items": {
                                "type": "string"
                            }
                        },
                        "prd": {
                            "type": "array",
                            "items": {
                                "type": "string"
                            }
                        }
                    },
                    "required": [
                        "default"
                    ]
                },
                "appServiceAuthIdentityGraphApiVersion": {
                    "type": "string"
                }
            },
            "required": [
                "appServiceAuthAction",
                "appServiceAuthIdentityProvider",
                "appServiceAuthIdentityClientId",
                "appServiceAuthIdentityClientSecretName",
                "appServiceAuthIdentityOpenIdIssuer",
                "appServiceAuthIdentityScopes",
                "appServiceAuthIdentityAudiences",
                "appServiceAuthIdentityGraphApiVersion"
            ]
        },
        "app-service-plan-sku": {
            "oneOf": [
                {
                    "const": "F1"
                },
                {
                    "const": "D1"
                },
                {
                    "const": "B1",
                    "description": "$12.41 USD/Month"
                },
                {
                    "const": "B2",
                    "description": "$24.82 USD/Month"
                }
            ]
        }
    }
}